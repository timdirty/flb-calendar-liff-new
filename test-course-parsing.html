<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>課程標題解析測試</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .test-section h3 {
            color: #007bff;
            margin-top: 0;
        }
        .test-case {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        .test-input {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-result {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .result-item {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .result-label {
            font-weight: bold;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .result-value {
            color: #333;
            font-family: 'Courier New', monospace;
        }
        .btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        .log-success {
            color: #28a745;
        }
        .log-error {
            color: #dc3545;
        }
        .log-info {
            color: #007bff;
        }
        .log-warning {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📝 課程標題解析測試</h1>
            <p>測試課程標題解析功能，驗證課程名稱和時間資訊的分離</p>
        </div>

        <div class="test-section">
            <h3>🧪 測試案例</h3>
            <div id="test-cases">
                <!-- 測試案例將在這裡動態生成 -->
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="runAllTests()">🚀 執行所有測試</button>
            <button class="btn btn-success" onclick="addCustomTest()">➕ 添加自定義測試</button>
            <button class="btn" onclick="clearLog()">🗑️ 清除日誌</button>
        </div>

        <div class="log" id="test-log">
            <div class="log-entry log-info">準備開始測試...</div>
        </div>
    </div>

    <script>
        // 課程標題解析函數（與主系統相同）
        function parseCourseTitle(fullTitle) {
            if (!fullTitle) {
                return { courseName: '未命名課程', timeInfo: '' };
            }

            // 常見的時間模式
            const timePatterns = [
                // 六 9:30-10:30 到府
                /([一二三四五六日])\s+(\d{1,2}:\d{2})-(\d{1,2}:\d{2})\s+(.+)/,
                // 六 9:30-10:30
                /([一二三四五六日])\s+(\d{1,2}:\d{2})-(\d{1,2}:\d{2})/,
                // 9:30-10:30 到府
                /(\d{1,2}:\d{2})-(\d{1,2}:\d{2})\s+(.+)/,
                // 9:30-10:30
                /(\d{1,2}:\d{2})-(\d{1,2}:\d{2})/,
                // 第X週
                /第(\d+)週/,
                // 請假
                /請假/
            ];

            let courseName = fullTitle;
            let timeInfo = '';

            // 嘗試匹配各種時間模式
            for (const pattern of timePatterns) {
                const match = fullTitle.match(pattern);
                if (match) {
                    if (pattern.source.includes('請假')) {
                        // 處理請假情況
                        courseName = fullTitle.replace(/請假.*$/, '').trim();
                        timeInfo = '請假';
                        break;
                    } else if (pattern.source.includes('第') && pattern.source.includes('週')) {
                        // 處理週次
                        const weekMatch = fullTitle.match(/第(\d+)週/);
                        if (weekMatch) {
                            courseName = fullTitle.replace(/第\d+週.*$/, '').trim();
                            timeInfo = `第${weekMatch[1]}週`;
                        }
                        break;
                    } else if (pattern.source.includes('一二三四五六日')) {
                        // 處理包含星期和時間的情況
                        const weekday = match[1];
                        const startTime = match[2];
                        const endTime = match[3];
                        const location = match[4] || '';
                        
                        courseName = fullTitle.replace(new RegExp(`${weekday}\\s+${startTime}-${endTime}\\s*${location}.*$`), '').trim();
                        timeInfo = `${weekday} ${startTime}-${endTime}${location ? ' ' + location : ''}`;
                        break;
                    } else if (pattern.source.includes('\\d{1,2}:\\d{2}')) {
                        // 處理只有時間的情況
                        const startTime = match[1];
                        const endTime = match[2];
                        const location = match[3] || '';
                        
                        courseName = fullTitle.replace(new RegExp(`${startTime}-${endTime}\\s*${location}.*$`), '').trim();
                        timeInfo = `${startTime}-${endTime}${location ? ' ' + location : ''}`;
                        break;
                    }
                }
            }

            // 如果沒有匹配到時間模式，嘗試簡單的分割
            if (timeInfo === '') {
                // 檢查是否包含時間格式
                const timeMatch = fullTitle.match(/(\d{1,2}:\d{2})-(\d{1,2}:\d{2})/);
                if (timeMatch) {
                    const timeIndex = fullTitle.indexOf(timeMatch[0]);
                    courseName = fullTitle.substring(0, timeIndex).trim();
                    timeInfo = fullTitle.substring(timeIndex).trim();
                }
            }

            // 清理課程名稱
            courseName = courseName.replace(/[第\d+週請假].*$/, '').trim();
            
            // 如果課程名稱為空，使用原始標題
            if (!courseName) {
                courseName = fullTitle;
                timeInfo = '';
            }

            return { courseName, timeInfo };
        }

        // 測試案例
        const testCases = [
            {
                input: 'ESM 六 9:30-10:30 到府 第4週請假',
                expected: { courseName: 'ESM', timeInfo: '六 9:30-10:30 到府' }
            },
            {
                input: 'SPM 六 9:30-11:00 到府 第2週',
                expected: { courseName: 'SPM', timeInfo: '六 9:30-11:00 到府' }
            },
            {
                input: '數學 一 14:00-15:30 教室A',
                expected: { courseName: '數學', timeInfo: '一 14:00-15:30 教室A' }
            },
            {
                input: '英文 9:30-10:30 線上',
                expected: { courseName: '英文', timeInfo: '9:30-10:30 線上' }
            },
            {
                input: '物理 第3週',
                expected: { courseName: '物理', timeInfo: '第3週' }
            },
            {
                input: '化學 請假',
                expected: { courseName: '化學', timeInfo: '請假' }
            },
            {
                input: '生物 9:30-10:30',
                expected: { courseName: '生物', timeInfo: '9:30-10:30' }
            },
            {
                input: '簡單課程',
                expected: { courseName: '簡單課程', timeInfo: '' }
            }
        ];

        function log(message, type = 'info') {
            const logContainer = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function createTestCaseElement(testCase, index) {
            const result = parseCourseTitle(testCase.input);
            const isCorrect = result.courseName === testCase.expected.courseName && 
                             result.timeInfo === testCase.expected.timeInfo;

            return `
                <div class="test-case">
                    <div class="test-input">測試案例 ${index + 1}: "${testCase.input}"</div>
                    <div class="test-result">
                        <div class="result-item">
                            <div class="result-label">課程名稱</div>
                            <div class="result-value" style="color: ${isCorrect ? '#28a745' : '#dc3545'}">
                                ${result.courseName}
                                ${result.courseName === testCase.expected.courseName ? ' ✅' : ' ❌'}
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">時間資訊</div>
                            <div class="result-value" style="color: ${isCorrect ? '#28a745' : '#dc3545'}">
                                ${result.timeInfo || '(無)'}
                                ${result.timeInfo === testCase.expected.timeInfo ? ' ✅' : ' ❌'}
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        期望: 課程="${testCase.expected.courseName}", 時間="${testCase.expected.timeInfo}"
                    </div>
                </div>
            `;
        }

        function renderTestCases() {
            const container = document.getElementById('test-cases');
            container.innerHTML = testCases.map((testCase, index) => 
                createTestCaseElement(testCase, index)
            ).join('');
        }

        function runAllTests() {
            log('🚀 開始執行所有測試...', 'info');
            
            let passedTests = 0;
            let totalTests = testCases.length;

            testCases.forEach((testCase, index) => {
                const result = parseCourseTitle(testCase.input);
                const isCorrect = result.courseName === testCase.expected.courseName && 
                                 result.timeInfo === testCase.expected.timeInfo;

                if (isCorrect) {
                    passedTests++;
                    log(`✅ 測試案例 ${index + 1} 通過: "${testCase.input}"`, 'success');
                } else {
                    log(`❌ 測試案例 ${index + 1} 失敗: "${testCase.input}"`, 'error');
                    log(`   期望: 課程="${testCase.expected.courseName}", 時間="${testCase.expected.timeInfo}"`, 'error');
                    log(`   實際: 課程="${result.courseName}", 時間="${result.timeInfo}"`, 'error');
                }
            });

            const successRate = Math.round((passedTests / totalTests) * 100);
            log(`📊 測試完成: ${passedTests}/${totalTests} 通過 (${successRate}%)`, 
                successRate === 100 ? 'success' : 'warning');

            if (successRate === 100) {
                log('🎉 所有測試通過！課程解析功能正常', 'success');
            } else if (successRate >= 80) {
                log('⚠️ 大部分測試通過，課程解析功能基本正常', 'warning');
            } else {
                log('❌ 多項測試失敗，需要檢查課程解析功能', 'error');
            }

            // 重新渲染測試案例以顯示結果
            renderTestCases();
        }

        function addCustomTest() {
            const input = prompt('請輸入要測試的課程標題:');
            if (input) {
                const result = parseCourseTitle(input);
                log(`🧪 自定義測試: "${input}"`, 'info');
                log(`   結果: 課程="${result.courseName}", 時間="${result.timeInfo}"`, 'info');
                
                // 添加到測試案例
                testCases.push({
                    input: input,
                    expected: result // 使用實際結果作為期望值
                });
                
                // 重新渲染
                renderTestCases();
            }
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '<div class="log-entry log-info">日誌已清除</div>';
        }

        // 頁面載入時渲染測試案例
        document.addEventListener('DOMContentLoaded', function() {
            log('頁面載入完成，準備開始測試', 'info');
            renderTestCases();
        });
    </script>
</body>
</html>
