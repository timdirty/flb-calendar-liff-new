<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç°½åˆ°å®Œæˆæª¢æ¸¬æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .test-section h3 {
            color: #555;
            margin-top: 0;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #f0f0f0;
            border-left: 4px solid #667eea;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .student-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        .student-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        .student-name {
            font-weight: 600;
            color: #333;
        }
        .student-buttons {
            display: flex;
            gap: 10px;
        }
        .present-btn, .absent-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .present-btn {
            background: #28a745;
            color: white;
        }
        .present-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }
        .absent-btn {
            background: #dc3545;
            color: white;
        }
        .absent-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        .present-btn.marked {
            background: #155724;
            transform: scale(0.95);
        }
        .absent-btn.marked {
            background: #721c24;
            transform: scale(0.95);
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        .completion-message {
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(40, 167, 69, 0.1);
            border: 2px solid #28a745;
            border-radius: 10px;
            color: #28a745;
            font-weight: 600;
            display: none;
        }
        .completion-message.show {
            display: block;
            animation: bounceIn 0.6s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  æ™ºèƒ½ç°½åˆ°å®Œæˆæª¢æ¸¬æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š ç°½åˆ°é€²åº¦</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="progressText">0/0 å­¸ç”Ÿå·²æ¨™è¨˜</div>
            <div class="completion-message" id="completionMessage">
                ğŸ‰ ç°½åˆ°å®Œæˆï¼æ‰€æœ‰å­¸ç”Ÿå·²æ¨™è¨˜
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ‘¥ å­¸ç”Ÿåå–®</h3>
            <div id="studentList">
                <!-- å­¸ç”Ÿå¡ç‰‡å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”§ æ¸¬è©¦æ§åˆ¶</h3>
            <button onclick="resetTest()">ğŸ”„ é‡ç½®æ¸¬è©¦</button>
            <button onclick="markAllPresent()">âœ… å…¨éƒ¨æ¨™è¨˜ç‚ºå‡ºå¸­</button>
            <button onclick="markAllAbsent()">âŒ å…¨éƒ¨æ¨™è¨˜ç‚ºç¼ºå¸­</button>
            <button onclick="markRandom()">ğŸ² éš¨æ©Ÿæ¨™è¨˜</button>
            <div id="testResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬å­¸ç”Ÿè³‡æ–™
        const students = [
            { id: 'student1', name: 'é™³å°æ˜' },
            { id: 'student2', name: 'æå°è¯' },
            { id: 'student3', name: 'ç‹å¤§é›„' },
            { id: 'student4', name: 'å¼µå°ç¾' },
            { id: 'student5', name: 'åŠ‰å°å¼·' }
        ];
        
        // ç°½åˆ°ç‹€æ…‹è¿½è¹¤
        let studentAttendanceStatus = {};
        let attendanceCheckTimer = null;
        let attendanceNotificationSent = false;
        
        // åˆå§‹åŒ–æ¸¬è©¦
        function initTest() {
            studentAttendanceStatus = {};
            attendanceNotificationSent = false;
            renderStudents();
            updateProgress();
        }
        
        // æ¸²æŸ“å­¸ç”Ÿåˆ—è¡¨
        function renderStudents() {
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = students.map(student => `
                <div class="student-card" data-student-id="${student.id}">
                    <div class="student-name">${student.name}</div>
                    <div class="student-buttons">
                        <button class="present-btn" onclick="markStudent('${student.id}', 'present')">âœ… å‡ºå¸­</button>
                        <button class="absent-btn" onclick="markStudent('${student.id}', 'absent')">âŒ ç¼ºå¸­</button>
                    </div>
                </div>
            `).join('');
        }
        
        // æ¨™è¨˜å­¸ç”Ÿ
        function markStudent(studentId, status) {
            console.log(`æ¨™è¨˜å­¸ç”Ÿ ${studentId} ç‚º ${status}`);
            
            // æ›´æ–°ç‹€æ…‹
            studentAttendanceStatus[studentId] = status;
            
            // æ›´æ–°UI
            updateStudentUI(studentId, status);
            updateProgress();
            
            // å•Ÿå‹•æ™ºèƒ½æª¢æ¸¬
            startAttendanceCheckTimer();
        }
        
        // æ›´æ–°å­¸ç”ŸUI
        function updateStudentUI(studentId, status) {
            const card = document.querySelector(`[data-student-id="${studentId}"]`);
            if (!card) return;
            
            const presentBtn = card.querySelector('.present-btn');
            const absentBtn = card.querySelector('.absent-btn');
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            presentBtn.classList.remove('marked');
            absentBtn.classList.remove('marked');
            
            // æ¨™è¨˜å°æ‡‰æŒ‰éˆ•
            if (status === 'present') {
                presentBtn.classList.add('marked');
            } else if (status === 'absent') {
                absentBtn.classList.add('marked');
            }
        }
        
        // æ›´æ–°é€²åº¦
        function updateProgress() {
            const totalStudents = students.length;
            const markedStudents = Object.keys(studentAttendanceStatus).length;
            const progress = totalStudents > 0 ? (markedStudents / totalStudents) * 100 : 0;
            
            // æ›´æ–°é€²åº¦æ¢
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progress}%`;
            
            // æ›´æ–°æ–‡å­—
            const progressText = document.getElementById('progressText');
            progressText.textContent = `${markedStudents}/${totalStudents} å­¸ç”Ÿå·²æ¨™è¨˜`;
            
            // æª¢æŸ¥æ˜¯å¦å®Œæˆ
            const completionMessage = document.getElementById('completionMessage');
            if (markedStudents === totalStudents && totalStudents > 0) {
                completionMessage.classList.add('show');
            } else {
                completionMessage.classList.remove('show');
            }
        }
        
        // æª¢æ¸¬æ˜¯å¦æ‰€æœ‰å­¸ç”Ÿéƒ½å·²ç°½åˆ°
        function checkAllStudentsMarked() {
            const totalStudents = students.length;
            const markedStudents = Object.keys(studentAttendanceStatus).length;
            
            console.log(`ğŸ” ç°½åˆ°å®Œæˆæª¢æ¸¬: ${markedStudents}/${totalStudents} å­¸ç”Ÿå·²æ¨™è¨˜`);
            return markedStudents === totalStudents;
        }
        
        // å•Ÿå‹•ç°½åˆ°æª¢æŸ¥å®šæ™‚å™¨
        function startAttendanceCheckTimer() {
            // æ¸…é™¤èˆŠçš„å®šæ™‚å™¨
            if (attendanceCheckTimer) {
                clearTimeout(attendanceCheckTimer);
            }
            
            // å¦‚æœæ‰€æœ‰å­¸ç”Ÿéƒ½å·²ç°½åˆ°ï¼Œç«‹å³ç™¼é€é€šçŸ¥
            if (checkAllStudentsMarked()) {
                console.log('âœ… æ‰€æœ‰å­¸ç”Ÿå·²ç°½åˆ°å®Œæˆï¼Œç«‹å³ç™¼é€é€šçŸ¥');
                sendNotification();
                return;
            }
            
            // å¦å‰‡ç­‰å¾…3ç§’å¾Œæª¢æŸ¥ä¸¦ç™¼é€é€šçŸ¥
            console.log('â° ç­‰å¾…3ç§’å¾Œç™¼é€é€šçŸ¥...');
            attendanceCheckTimer = setTimeout(() => {
                sendNotification();
            }, 3000);
        }
        
        // ç™¼é€é€šçŸ¥
        function sendNotification() {
            if (attendanceNotificationSent) {
                console.log('âš ï¸ é€šçŸ¥å·²ç™¼é€éï¼Œè·³é');
                return;
            }
            
            const totalStudents = students.length;
            const markedStudents = Object.keys(studentAttendanceStatus).length;
            const allStudentsMarked = checkAllStudentsMarked();
            
            let message = `ğŸ“š å­¸ç”Ÿç°½åˆ°é€šçŸ¥\n\n`;
            message += `ğŸ‘¨â€ğŸ« è¬›å¸«ï¼šæ¸¬è©¦è¬›å¸«\n`;
            message += `ğŸ“– èª²ç¨‹ï¼šæ¸¬è©¦èª²ç¨‹\n`;
            message += `ğŸ“… æ—¥æœŸï¼š${new Date().toLocaleDateString('zh-TW')}\n\n`;
            
            if (allStudentsMarked) {
                message += `ğŸ‰ ç°½åˆ°å®Œæˆï¼æ‰€æœ‰å­¸ç”Ÿå·²æ¨™è¨˜\n\n`;
            } else {
                message += `â³ ç°½åˆ°é€²è¡Œä¸­ (${markedStudents}/${totalStudents} å·²æ¨™è¨˜)\n\n`;
            }
            
            // åˆ†é¡å­¸ç”Ÿ
            const presentStudents = [];
            const absentStudents = [];
            const unmarkedStudents = [];
            
            students.forEach(student => {
                const status = studentAttendanceStatus[student.id];
                if (status === 'present') {
                    presentStudents.push(student.name);
                } else if (status === 'absent') {
                    absentStudents.push(student.name);
                } else {
                    unmarkedStudents.push(student.name);
                }
            });
            
            if (presentStudents.length > 0) {
                message += `âœ… å‡ºå¸­ (${presentStudents.length}äºº)ï¼š\n${presentStudents.join('ã€')}\n\n`;
            }
            
            if (absentStudents.length > 0) {
                message += `âŒ ç¼ºå¸­ (${absentStudents.length}äºº)ï¼š\n${absentStudents.join('ã€')}\n\n`;
            }
            
            if (unmarkedStudents.length > 0) {
                message += `â³ æœªé¸æ“‡ (${unmarkedStudents.length}äºº)ï¼š\n${unmarkedStudents.join('ã€')}\n\n`;
            }
            
            message += `â° ç°½åˆ°æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`;
            
            console.log('ğŸ“¤ ç™¼é€é€šçŸ¥:', message);
            
            // é¡¯ç¤ºçµæœ
            const result = document.getElementById('testResult');
            result.style.display = 'block';
            result.className = 'result success';
            result.innerHTML = `<strong>âœ… é€šçŸ¥å·²ç™¼é€ï¼</strong><br><pre>${message}</pre>`;
            
            attendanceNotificationSent = true;
        }
        
        // æ¸¬è©¦æ§åˆ¶å‡½æ•¸
        function resetTest() {
            studentAttendanceStatus = {};
            attendanceNotificationSent = false;
            if (attendanceCheckTimer) {
                clearTimeout(attendanceCheckTimer);
                attendanceCheckTimer = null;
            }
            renderStudents();
            updateProgress();
            document.getElementById('testResult').style.display = 'none';
            console.log('ğŸ”„ æ¸¬è©¦å·²é‡ç½®');
        }
        
        function markAllPresent() {
            students.forEach(student => {
                markStudent(student.id, 'present');
            });
        }
        
        function markAllAbsent() {
            students.forEach(student => {
                markStudent(student.id, 'absent');
            });
        }
        
        function markRandom() {
            students.forEach(student => {
                const status = Math.random() > 0.5 ? 'present' : 'absent';
                markStudent(student.id, status);
            });
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        initTest();
    </script>
</body>
</html>
